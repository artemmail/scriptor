<!-- editor-page.component.html -->
<div class="page-container">

  <ng-container *ngIf="!loading && !errorMessage; else loadingOrError">

    <mat-card class="editor-card">
      <md-editor
        name="contentEditor"
        [(ngModel)]="markdownContent"
        preview="vertical"
        height="'100%'"
        [options]="editorOptions"
        [preRender]="renderWithMath">
      </md-editor>
    </mat-card>

    <div class="actions-panel">
      <div class="actions-header">
        <h2>Действия</h2>
        <div class="actions-buttons">
          <button
            class="btn btn-outline"
            type="button"
            (click)="onDownloadMd()"
            [disabled]="!hasContent"
            aria-label="Скачать Markdown"
          >
            <mat-icon>download</mat-icon>
            <span>Скачать .md</span>
          </button>
          <button
            class="btn btn-primary"
            type="button"
            (click)="onSave()"
            [disabled]="!hasContent"
            aria-label="Сохранить изменения"
          >
            <mat-icon>save</mat-icon>
            <span>Сохранить</span>
          </button>
          <button
            class="btn btn-danger"
            type="button"
            (click)="onDelete()"
            [disabled]="!task"
            aria-label="Удалить задачу"
          >
            <mat-icon>delete</mat-icon>
            <span>Удалить задачу</span>
          </button>
        </div>
      </div>
    </div>

  </ng-container>

  <ng-template #loadingOrError>
    <ng-container *ngIf="errorMessage; else loading">
      <p class="error">{{ errorMessage }}</p>
    </ng-container>
    <ng-template #loading>
      <app-task-progress
        [taskId]="taskId"
        (taskLoaded)="onTaskLoaded($event)"
        (taskDone)="onTaskDone($event)"
        (taskError)="onTaskError($event)"
      ></app-task-progress>
    </ng-template>
  </ng-template>

</div>
