<ng-container *ngIf="youtubeTask !== null; else loading">
  <div class="progress-card" [ngClass]="getCardClass(youtubeTask!.status)">
    <div class="progress-header">
      <span class="status-icon" [ngClass]="getIconClass(youtubeTask!.status)">
        <mat-icon>{{ getStatusIcon(youtubeTask!.status) }}</mat-icon>
      </span>
      <div class="progress-title">
        <h2>Задача обрабатывается</h2>
        <p *ngIf="youtubeTask!.status !== null">
          {{ getStatusText(youtubeTask!.status) }}
        </p>
      </div>
    </div>

    <app-yandex-ad></app-yandex-ad>

    <div class="progress-body">
      <div class="progress-meta">
        <div *ngIf="youtubeTask!.createdAt">
          <span class="meta-label">Начало</span>
          <span class="meta-value">{{ youtubeTask!.createdAt | localTime: 'yyyy-MM-dd HH:mm:ss' }}</span>
        </div>
        <div *ngIf="youtubeTask!.modifiedAt">
          <span class="meta-label">Обновлено</span>
          <span class="meta-value">{{ youtubeTask!.modifiedAt | localTime: 'yyyy-MM-dd HH:mm:ss' }}</span>
        </div>
      </div>

      <div class="progress-status" *ngIf="youtubeTask!.status === RecognizeStatus.Error">
        <div class="error-message">Произошла ошибка: {{ youtubeTask!.error || 'Не удалось распознать задачу' }}</div>
      </div>

      <div
        class="progress-status"
        *ngIf="youtubeTask && youtubeTask.status !== RecognizeStatus.Error && !youtubeTask.done"
      >
        <span class="status-text">Текущий статус: {{ getStatusText(youtubeTask!.status) }}</span>

        <mat-progress-bar
          *ngIf="youtubeTask!.status === RecognizeStatus.ApplyingPunctuationSegment &&
                  youtubeTask!.segmentsTotal !== undefined &&
                  youtubeTask!.segmentsProcessed !== undefined"
          mode="determinate"
          [value]="(youtubeTask!.segmentsProcessed / youtubeTask!.segmentsTotal) * 100"
        ></mat-progress-bar>

        <p *ngIf="youtubeTask!.status === RecognizeStatus.ApplyingPunctuationSegment">
          Обработано: {{ youtubeTask!.segmentsProcessed }} из {{ youtubeTask!.segmentsTotal }}
        </p>
      </div>
    </div>
  </div>
</ng-container>

<ng-template #loading>
  <div class="spinner-container">
    <mat-progress-spinner mode="indeterminate" diameter="48"></mat-progress-spinner>
  </div>
</ng-template>
