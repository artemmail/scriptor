<div class="page-container" *ngIf="!loading && !errorMessage; else loadingOrError">
  <mat-card class="editor-card">
    <md-editor
      name="transcriptionEditor"
      [(ngModel)]="markdownContent"
      preview="vertical"
      height="'100%'"
      [options]="editorOptions"
      [preRender]="renderWithMath"
    >
    </md-editor>
  </mat-card>

  <div class="actions">
    <button
      mat-raised-button
      color="primary"
      [matMenuTriggerFor]="downloadMenu"
      [disabled]="exporting || !hasAnyDownloadOption()"
    >
      <mat-icon>download</mat-icon>
      Скачать
    </button>

    <mat-menu #downloadMenu="matMenu">
      <button
        mat-menu-item
        (click)="onDownload('md')"
        [disabled]="exporting || !isFormatAvailable('md')"
      >
        <mat-icon>article</mat-icon>
        Markdown (.md)
      </button>
      <button
        mat-menu-item
        (click)="onDownload('pdf')"
        [disabled]="exporting || !isFormatAvailable('pdf')"
      >
        <mat-icon>picture_as_pdf</mat-icon>
        PDF
      </button>
      <button
        mat-menu-item
        (click)="onDownload('docx')"
        [disabled]="exporting || !isFormatAvailable('docx')"
      >
        <mat-icon>description</mat-icon>
        Word (.docx)
      </button>
      <button
        mat-menu-item
        (click)="onDownload('srt')"
        [disabled]="exporting || !isFormatAvailable('srt')"
      >
        <mat-icon>subtitles</mat-icon>
        SRT субтитры
      </button>
    </mat-menu>

    <button
      mat-stroked-button
      color="primary"
      [matMenuTriggerFor]="copyMenu"
      [disabled]="exporting || !hasAnyCopyOption()"
    >
      <mat-icon>content_copy</mat-icon>
      Копировать
    </button>

    <mat-menu #copyMenu="matMenu">
      <button
        mat-menu-item
        (click)="onCopy('txt')"
        [disabled]="exporting || !isCopyFormatAvailable('txt')"
      >
        <mat-icon>notes</mat-icon>
        Текст (plain)
      </button>
      <button
        mat-menu-item
        (click)="onCopy('markdown')"
        [disabled]="exporting || !isCopyFormatAvailable('markdown')"
      >
        <mat-icon>code</mat-icon>
        Markdown
      </button>
      <button
        mat-menu-item
        (click)="onCopy('html')"
        [disabled]="exporting || !isCopyFormatAvailable('html')"
      >
        <mat-icon>language</mat-icon>
        HTML
      </button>
      <button
        mat-menu-item
        (click)="onCopy('bbcode')"
        [disabled]="exporting || !isCopyFormatAvailable('bbcode')"
      >
        <mat-icon>format_quote</mat-icon>
        BBCode
      </button>
      <button
        mat-menu-item
        (click)="onCopy('srt')"
        [disabled]="exporting || !isCopyFormatAvailable('srt')"
      >
        <mat-icon>subtitles</mat-icon>
        SRT субтитры
      </button>
    </mat-menu>

    <span class="spacer"></span>

    <button
      mat-raised-button
      color="accent"
      (click)="onSave()"
      [disabled]="!hasContent() || saving"
    >
      <mat-icon>save</mat-icon>
      Сохранить
    </button>

    <button
      mat-raised-button
      color="warn"
      (click)="onDelete()"
      [disabled]="deleting"
    >
      <mat-icon>delete</mat-icon>
      Удалить
    </button>
  </div>
</div>

<ng-template #loadingOrError>
  <div class="status-block" *ngIf="loading">
    <mat-progress-spinner mode="indeterminate" diameter="40"></mat-progress-spinner>
    <p>Загружаем данные…</p>
  </div>
  <div class="status-block error" *ngIf="!loading && errorMessage">
    <p>{{ errorMessage }}</p>
  </div>
</ng-template>
