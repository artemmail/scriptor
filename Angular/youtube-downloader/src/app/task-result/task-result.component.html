<div class="recognized-card" *ngIf="youtubeTask as task">
  <div class="video-summary">
    <div class="video-summary-left">
      <button
        *ngIf="isAuthenticated"
        class="yt-logo-button"
        type="button"
        (click)="openVideoDialog(task)"
        aria-label="Открыть видео"
      >
        <img src="assets/yt.webp" alt="YouTube" class="youtube-logo" />
      </button>
      <div class="video-text">
        <span class="promo-tagline">{{ promoText }}</span>
        <h1 class="video-title" *ngIf="task.title; else defaultTitle">{{ task.title }}</h1>
        <ng-template #defaultTitle>
          <h1 class="video-title">Результат распознавания</h1>
        </ng-template>
        <div class="video-meta">
          <span *ngIf="task.channelName">Канал: {{ task.channelName }}</span>
          <span *ngIf="task.uploadDate">· Видео от {{ task.uploadDate | localTime: 'yyyy-MM-dd' }}</span>
          <span *ngIf="task.createdAt">· Обновлено {{ task.createdAt | localTime: 'yyyy-MM-dd HH:mm' }}</span>
        </div>
      </div>
    </div>
  </div>

  <section class="result-block" [class.fullscreen]="isResultFullscreen">
    <div class="result-header">
      <h2>Результат</h2>
      <div class="result-actions">
        <a
          class="btn btn-outline"
          *ngIf="task.id"
          [routerLink]="['/markdown-converter', task.id]"
          aria-label="Редактировать"
        >
          <mat-icon>edit</mat-icon>
          <span>Редактировать</span>
        </a>
        <button
          class="btn btn-outline"
          type="button"
          [matMenuTriggerFor]="downloadMenu"
          [disabled]="isDownloading || !hasAnyDownloadOption"
          aria-label="Скачать"
        >
          <mat-icon>download</mat-icon>
          <span>Скачать</span>
        </button>
        <button
          class="btn btn-outline"
          type="button"
          [matMenuTriggerFor]="copyMenu"
          [disabled]="isCopying || !hasAnyCopyOption"
          aria-label="Копировать"
        >
          <mat-icon>content_copy</mat-icon>
          <span>Копировать</span>
        </button>
        <button
          class="btn btn-outline"
          type="button"
          (click)="toggleFullscreen()"
          [attr.aria-pressed]="isResultFullscreen"
          [attr.aria-label]="isResultFullscreen ? 'Свернуть результат' : 'Открыть результат на весь экран'"
        >
          <mat-icon>{{ isResultFullscreen ? 'fullscreen_exit' : 'fullscreen' }}</mat-icon>
          <span>{{ isResultFullscreen ? 'Свернуть' : 'На весь экран' }}</span>
        </button>
      </div>
    </div>

    <mat-menu #downloadMenu="matMenu" actionMenuPanel>
      <button mat-menu-item (click)="downloadAsPdf()" [disabled]="isDownloading || !canDownloadFromServer">
        <mat-icon>picture_as_pdf</mat-icon>
        <span>PDF</span>
      </button>
      <button mat-menu-item (click)="downloadAsWord()" [disabled]="isDownloading || !canDownloadFromServer">
        <mat-icon>description</mat-icon>
        <span>Word (.docx)</span>
      </button>
      <button mat-menu-item (click)="downloadAsSrt()" [disabled]="isDownloading || !canDownloadFromServer">
        <mat-icon>subtitles</mat-icon>
        <span>SRT субтитры</span>
      </button>
      <button mat-menu-item (click)="downloadAsMd()" [disabled]="isDownloading || !hasResultText">
        <mat-icon>article</mat-icon>
        <span>Markdown (.md)</span>
      </button>
      <button mat-menu-item (click)="downloadAsHtml()" [disabled]="isDownloading || !hasResultText">
        <mat-icon>language</mat-icon>
        <span>HTML</span>
      </button>
    </mat-menu>

    <mat-menu #copyMenu="matMenu" actionMenuPanel>
      <button mat-menu-item (click)="copyToClipboard()" [disabled]="isCopying || !hasResultText">
        <mat-icon>notes</mat-icon>
        <span>Текст (plain)</span>
      </button>
      <button mat-menu-item (click)="copyHtmlToClipboard()" [disabled]="isCopying || !hasResultText">
        <mat-icon>code</mat-icon>
        <span>HTML</span>
      </button>
    </mat-menu>

    <div class="result-alert" *ngIf="task.error">{{ task.error }}</div>

    <app-yandex-ad></app-yandex-ad>

    <div
      class="markdown-content"
      #markdownContent
      [innerHTML]="processedMarkdown"
      *ngIf="hasResultText; else emptyState"
    ></div>

    <ng-template #emptyState>
      <div class="empty-state">Расшифровка пока недоступна.</div>
    </ng-template>
  </section>
</div>
