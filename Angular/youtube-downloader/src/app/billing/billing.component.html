<div class="billing-container" *ngIf="!loadingPlans && !loadingWallet; else loadingTemplate">
  <section class="wallet" *ngIf="wallet">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Баланс для распознавания митингов</mat-card-title>
        <mat-card-subtitle>Средства списываются при обработке митингов</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="wallet__balance">
          <span class="wallet__amount">{{ wallet.balance | number:'1.0-2' }} {{ wallet.currency }}</span>
          <span class="wallet__hint" *ngIf="infoMessage">{{ infoMessage }}</span>
        </div>
        <form class="wallet__form" (ngSubmit)="deposit()">
          <mat-form-field appearance="outline">
            <mat-label>Сумма пополнения</mat-label>
            <input matInput type="number" [formControl]="depositControl" min="100" max="100000" step="100" />
            <mat-hint>Минимум 100 ₽</mat-hint>
            <mat-error *ngIf="depositControl.hasError('required')">Укажите сумму</mat-error>
            <mat-error *ngIf="depositControl.hasError('min')">Минимальная сумма — 100 ₽</mat-error>
            <mat-error *ngIf="depositControl.hasError('max')">Максимальная сумма — 100000 ₽</mat-error>
          </mat-form-field>
          <button mat-flat-button color="primary" type="submit" [disabled]="depositControl.invalid || submitting">
            Пополнить кошелёк
          </button>
        </form>
      </mat-card-content>
    </mat-card>
  </section>

  <section class="plans">
    <h2>Подписки</h2>
    <div class="plans__grid">
      <mat-card *ngFor="let plan of plans" class="plan-card">
        <mat-card-header>
          <mat-card-title>{{ plan.name }}</mat-card-title>
          <mat-card-subtitle>{{ getPlanDuration(plan) }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <p class="plan-card__price">{{ formatPrice(plan) }}</p>
          <p class="plan-card__description" *ngIf="plan.description">{{ plan.description }}</p>
          <mat-list>
            <mat-list-item *ngIf="plan.canHideCaptions">
              <mat-icon matListItemIcon color="primary">visibility_off</mat-icon>
              <span matListItemTitle>Скрытие собственных видео из общего доступа</span>
            </mat-list-item>
            <mat-list-item *ngIf="plan.isUnlimitedRecognitions">
              <mat-icon matListItemIcon color="primary">speed</mat-icon>
              <span matListItemTitle>Без ограничений на количество распознаваний</span>
            </mat-list-item>
            <mat-list-item *ngIf="!plan.canHideCaptions && !plan.isUnlimitedRecognitions">
              <mat-icon matListItemIcon color="primary">star</mat-icon>
              <span matListItemTitle>Специальные возможности аккаунта</span>
            </mat-list-item>
          </mat-list>
        </mat-card-content>
        <mat-card-actions>
          <button mat-stroked-button color="primary" (click)="buyPlan(plan)" [disabled]="submitting">
            Оформить подписку
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </section>
</div>

<ng-template #loadingTemplate>
  <div class="loading">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
  </div>
</ng-template>
