<!-- recognition-tasks.component.html -->
<div class="tasks-table">
  <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">

    <!-- Status Column -->
    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
      <td mat-cell *matCellDef="let task">{{ task.status }}</td>
    </ng-container>

    <!-- Done Column -->
    <ng-container matColumnDef="done">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Done </th>
      <td mat-cell *matCellDef="let task">{{ task.done ? 'Yes' : 'No' }}</td>
    </ng-container>

    <!-- Created At Column -->
    <ng-container matColumnDef="createdAt">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Created At </th>
      <td mat-cell *matCellDef="let task">{{ task.createdAt | date }}  {{ task.uploadDate  |  localTime: 'yyyy-MM-dd HH:mm:ss' }}</td>
    </ng-container>

    <!-- Language Column -->
    <ng-container matColumnDef="language">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Language </th>
      <td mat-cell *matCellDef="let task">
        {{ task.language }}
      </td>
    </ng-container>

    <!-- Result Column (Markdown, с toggling) -->
    <ng-container matColumnDef="result">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Result </th>
      <td mat-cell *matCellDef="let task">
        <div
        class="markdown-container"
        [ngClass]="{ collapsed: !isExpanded(task.id) }"
      >
        <markdown [data]="task.result"></markdown>
      </div>
      

        <!-- Кнопки управления -->
        <div style="margin-top: 8px;">
          <button mat-button color="primary" (click)="toggleExpand(task.id)">
            <!-- Меняем подпись в зависимости от состояния -->
            {{ isExpanded(task.id) ? 'Свернуть' : 'Развернуть' }}
          </button>

          <!-- Ссылка для открытия полной страницы -->
          <a
            [routerLink]="['/recognized', task.id]"
            style="margin-left: 8px; text-decoration: underline; cursor: pointer;"
          >
            Перейти к полной версии
          </a>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>

  <mat-paginator
    [pageSize]="15"
    [pageSizeOptions]="[5, 10, 15]"
    showFirstLastButtons
  ></mat-paginator>
</div>
